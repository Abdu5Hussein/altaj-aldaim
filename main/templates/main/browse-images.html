{% extends 'main/base.html' %}
{% load static i18n %}
<!-- prettier-ignore -->
{# templates/main/project_gallery.html #}
{% block title %}
  {{ project.title|default:_("Project") }} - {% trans "Gallery" %}
{% endblock %}

{% block extra_head %}
<style>
  .gallery-container{max-width:1400px;margin:0 auto;padding:30px 20px;}
  .gallery-main{display:grid;grid-template-columns:1fr 1fr;gap:50px;margin-bottom:60px;}
  @media (max-width:992px){.gallery-main{grid-template-columns:1fr;gap:30px;}}

  .gallery-preview{position:sticky;top:100px;height:fit-content;}
  @media (max-width:992px){.gallery-preview{position:static;}}

  .main-media-container{
    position:relative;width:100%;height:520px;border-radius:12px;overflow:hidden;
    background:var(--light);margin-bottom:20px;border:1px solid var(--card-border-color);
  }
  .main-media{width:100%;height:100%;object-fit:contain;padding:20px;transition:transform .3s ease;}
  .main-media:hover{transform:scale(1.04);}

  .video-container{width:100%;height:100%;background:#000;}
  .project-video{width:100%;height:100%;object-fit:contain;}

  .media-badge{
    position:absolute;top:20px;right:20px;z-index:2;
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    color:#fff;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:700;
    text-transform:uppercase;letter-spacing:.5px;
  }

  .open-original-btn{
    position:absolute;left:20px;top:20px;z-index:2;
    background:rgba(0,0,0,.55);color:#fff;border:1px solid rgba(255,255,255,.25);
    border-radius:10px;padding:8px 12px;font-size:13px;cursor:pointer;
    display:flex;align-items:center;gap:8px;transition:all .25s ease;
  }
  .open-original-btn:hover{background:rgba(0,0,0,.75);transform:translateY(-1px);}

  .play-btn{
    position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
    width:80px;height:80px;border:none;border-radius:50%;
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    color:#fff;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;
    transition:all .3s ease;z-index:2;box-shadow:0 8px 25px rgba(37,99,235,.3);
  }
  .play-btn:hover{
    background:var(--primary-dark);
    transform:translate(-50%,-50%) scale(1.08);
    box-shadow:0 12px 30px rgba(37,99,235,.4);
  }

  .thumbs{display:flex;gap:10px;overflow-x:auto;padding:10px 0;}
  .thumb{
    width:82px;height:82px;border-radius:10px;overflow:hidden;cursor:pointer;
    border:3px solid transparent;transition:all .25s ease;flex-shrink:0;background:var(--light);
  }
  .thumb.active{border-color:var(--primary);}
  .thumb img{width:100%;height:100%;object-fit:cover;}
  .thumb .thumb-video{
    width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;color:#fff;
  }

  .project-info{padding:20px 0;}
  .project-client{
    font-size:14px;color:var(--primary);margin-bottom:10px;text-transform:uppercase;
    letter-spacing:.5px;font-weight:700;
  }
  .project-title{font-size:32px;font-weight:800;color:var(--text-color);margin-bottom:16px;line-height:1.25;}
  .project-meta{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:18px;}
  .meta-pill{
    background:var(--card-bg);border:1px solid var(--card-border-color);
    border-radius:999px;padding:8px 12px;font-size:13px;color:var(--text-color);
    display:flex;align-items:center;gap:8px;
  }
  .meta-pill i{color:var(--primary);}
  .project-desc{
    margin-bottom:22px;line-height:1.85;color:var(--text-color);
    padding:20px;background:var(--card-bg);border-radius:10px;border:1px solid var(--card-border-color);
  }

  .actions{display:flex;gap:12px;margin-top:12px;flex-wrap:wrap;}
  .btn-primary-like{
    flex:1 1 240px;padding:14px 18px;border:none;border-radius:10px;
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    color:#fff;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;
    transition:all .25s ease;
  }
  .btn-primary-like:hover{transform:translateY(-2px);box-shadow:0 10px 28px rgba(37,99,235,.28);}
  .btn-outline-like{
    flex:1 1 240px;padding:14px 18px;border-radius:10px;
    background:var(--card-bg);color:var(--text-color);
    border:2px solid var(--card-border-color);
    font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;
    transition:all .25s ease;
  }
  .btn-outline-like:hover{border-color:var(--primary);color:var(--primary);}

  .more-section{padding:40px 0;border-top:1px solid var(--card-border-color);}
  .section-title{font-size:24px;font-weight:800;color:var(--text-color);margin-bottom:25px;}
  .more-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;}
  .project-card{
    background:var(--card-bg);border:1px solid var(--card-border-color);border-radius:14px;overflow:hidden;
    text-decoration:none;color:inherit;box-shadow:0 4px 12px rgba(0,0,0,.08);
    transition:all .25s ease;display:block;
  }
  .project-card:hover{transform:translateY(-4px);border-color:var(--primary);box-shadow:0 10px 24px rgba(0,0,0,.15);}
  .card-img{width:100%;height:190px;object-fit:cover;background:var(--light);}
  .card-body{padding:16px;}
  .card-title{
    font-size:16px;font-weight:800;margin-bottom:6px;color:var(--text-color);
    display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
  }
  .card-sub{font-size:13px;color:var(--secondary);}

  @media (max-width:768px){
    .gallery-container{padding:15px;}
    .main-media-container{height:380px;}
    .project-title{font-size:24px;}
  }
  @media (max-width:480px){
    .main-media-container{height:300px;}
  }

  .toast-note{
    position:fixed;bottom:100px;right:20px;
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    color:#fff;padding:14px 18px;border-radius:12px;display:none;align-items:center;gap:10px;
    z-index:10001;box-shadow:0 12px 28px rgba(37,99,235,.35);max-width:320px;
    animation:slideInUp .25s ease;
  }
  .toast-note.show{display:flex;}
  @keyframes slideInUp{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}
</style>
{% endblock %}

{% block content %}
<div class="gallery-container">

  <main class="gallery-main">

    <!-- Left: Preview -->
    <div class="gallery-preview">
      <div class="main-media-container">
        <img
            src="{% static 'main/img/ug-1.jpeg' %}"
            alt="image"
            class="main-media"
            id="mainImage"
        />

        <button class="open-original-btn" type="button" onclick="openOriginal()">
          <i class="fas fa-external-link-alt"></i>
          {% trans "Open original" %}
        </button>
      </div>

      <!-- Thumbnails (STATIC LIST) -->
      <div class="thumbs" id="thumbsBar">

        <div class="thumb active"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-1.jpeg" %}')">
          <img src="{% static 'main/img/ug-1.jpeg' %}" alt="1">
        </div>

        <div class="thumb"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-2.jpeg" %}')">
          <img src="{% static "main/img/ug-2.jpeg" %}" alt="2">
        </div>

        <div class="thumb"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-3.jpeg" %}')">
          <img src="{% static "main/img/ug-3.jpeg" %}" alt="3">
        </div>

        <div class="thumb"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-4.jpeg" %}')">
          <img src="{% static "main/img/ug-4.jpeg" %}" alt="4">
        </div>
        <div class="thumb"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-5.jpeg" %}')">
          <img src="{% static "main/img/ug-5.jpeg" %}" alt="5">
        </div>
        <div class="thumb"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-6.jpeg" %}')">
          <img src="{% static "main/img/ug-6.jpeg" %}" alt="6">
        </div>
        <div class="thumb"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-7.jpeg" %}')">
          <img src="{% static "main/img/ug-7.jpeg" %}" alt="7">
        </div>
        <div class="thumb"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-8.jpeg" %}')">
          <img src="{% static "main/img/ug-8.jpeg" %}" alt="8">
        </div>
        <div class="thumb"
             onclick="showImageFromThumb(this, '{% static "main/img/ug-9.jpeg" %}')">
          <img src="{% static "main/img/ug-9.jpeg" %}" alt="9">
        </div>

      </div>
    </div>

    <!-- Right: Info -->
    <div class="project-info">
      <div class="project-client">
        {% trans "Browse images" %}
      </div>

      <h1 class="project-title">
        {% trans "Our projects" %}
      </h1>

      <div class="project-desc">
        {% trans "Images from products and projects we have worked on." %}
      </div>

      <div class="actions">
          <button class="btn-outline-like" type="button" onclick="copyLink()">
            <i class="fas fa-link"></i>
            {% trans "Copy page link" %}
          </button>
      </div>
    </div>

  </main>

  <!-- More Projects (optional, DB-based) -->
  {% if more_projects %}
    <section class="more-section">
      <h2 class="section-title">{% trans "More Projects" %}</h2>
      <div class="more-grid">
        {% for p in more_projects %}
          <a class="project-card" href="{% url 'project_detail' p.id %}">
            <img class="card-img"
                 src="{% if p.cover %}{{ p.cover.url }}{% else %}{% static 'main/img/product-default.jpg' %}{% endif %}"
                 alt="{{ p.title }}">
            <div class="card-body">
              <div class="card-title">{{ p.title }}</div>
              <div class="card-sub">{{ p.client_name|default:_("Client") }}</div>
            </div>
          </a>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  <div class="toast-note" id="toastNote">
    <i class="fas fa-check-circle"></i>
    <span id="toastText">{% trans "Copied!" %}</span>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
  // ========= Project Gallery JS (STATIC images + optional video) =========

  const hasVideo = {% if project.video %}true{% else %}false{% endif %};
  const videoEl = document.getElementById("projectVideo");
  const playBtn = document.getElementById("playVideoBtn");
  const mainImage = document.getElementById("mainImage");

  const toast = document.getElementById("toastNote");
  const toastText = document.getElementById("toastText");

  document.addEventListener("DOMContentLoaded", function () {
    setupVideoControls();
  });

  function setupVideoControls() {
    if (playBtn && hasVideo) {
      playBtn.addEventListener("click", function () {
        if (!videoEl) return;
        videoEl.style.display = "block";
        if (mainImage) mainImage.style.display = "none";
        playBtn.style.display = "none";
        videoEl.play();
      });
    }
  }

  window.showImageFromThumb = function (el, imageUrl) {
    if (videoEl) {
      videoEl.pause();
      videoEl.style.display = "none";
      if (playBtn) playBtn.style.display = hasVideo ? "flex" : "none";
    }

    if (mainImage) {
      mainImage.style.display = "block";
      mainImage.src = imageUrl;
    }

    document.querySelectorAll(".thumb").forEach(t => t.classList.remove("active"));
    if (el) el.classList.add("active");
  };

  window.showVideoFromThumb = function (el) {
    if (!videoEl) return;

    videoEl.style.display = "block";
    if (mainImage) mainImage.style.display = "none";
    if (playBtn) playBtn.style.display = "none";
    videoEl.play();

    document.querySelectorAll(".thumb").forEach(t => t.classList.remove("active"));
    if (el) el.classList.add("active");
  };

  function openOriginal() {
    if (videoEl && videoEl.style.display === "block") {
      window.open(videoEl.currentSrc || "{{ project.video.url|default:'' }}", "_blank");
      return;
    }
    if (mainImage && mainImage.src) window.open(mainImage.src, "_blank");
  }

  async function copyLink() {
    try {
      await navigator.clipboard.writeText(window.location.href);
      showToast("{% trans 'Link copied' %}");
    } catch (e) {
      showToast("{% trans 'Copy failed' %}");
    }
  }

  function showToast(msg) {
    if (!toast || !toastText) return;
    toastText.textContent = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2500);
  }
</script>
{% endblock %}
